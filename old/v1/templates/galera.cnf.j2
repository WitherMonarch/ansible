# Common default template content
[mysqld]

binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
bind-address=0.0.0.0

##
## WSREP options
##
{% if inventory_hostname == 'maria1' and bootstrap | default(false) %}
# Maria1 bootstrap
wsrep_on=1
wsrep_cluster_name="{{ galera_cluster_name }}"
wsrep_cluster_address="gcomm://"
wsrep_node_name="{{ inventory_hostname }}"
wsrep_node_address="{{ ansible_host }}"
{% elif inventory_hostname == 'maria1' %}
# Maria1 full config after bootstrap
wsrep_on=1
wsrep_cluster_name="{{ galera_cluster_name }}"
wsrep_cluster_address="gcomm://{{ galera_nodes | join(',') }}"
wsrep_node_name="{{ inventory_hostname }}"
wsrep_node_address="{{ ansible_host }}"
wsrep_sst_auth=root:{{ mariadb_root_password }}
{% else %}
# Maria2 / Maria3 replicas
wsrep_on=1
wsrep_cluster_name="{{ galera_cluster_name }}"
wsrep_cluster_address="gcomm://{{ galera_nodes | join(',') }}"
wsrep_node_name="{{ inventory_hostname }}"
wsrep_node_address="{{ ansible_host }}"
wsrep_sst_auth=root:{{ mariadb_root_password }}
{% endif %}

wsrep_slave_threads=1
wsrep_certify_nonPK=1
wsrep_max_ws_rows=0
wsrep_max_ws_size=2147483647
wsrep_debug=0
wsrep_convert_LOCK_to_trx=0
wsrep_retry_autocommit=1
wsrep_auto_increment_control=1
wsrep_drupal_282555_workaround=0
wsrep_causal_reads=0
