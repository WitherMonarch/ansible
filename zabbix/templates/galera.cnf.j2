# Common default template content
[mysqld]

binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
innodb_buffer_pool_size=2G
innodb_flush_log_at_trx_commit=2
innodb_file_per_table=1
bind-address=0.0.0.0

##
## WSREP options
##
{% if inventory_hostname == 'maria1' and bootstrap | default(false) %}
# Maria1 bootstrap
wsrep_on=1
wsrep_cluster_name="{{ galera_cluster_name }}"
wsrep_cluster_address="gcomm://"
wsrep_node_name="{{ inventory_hostname }}"
wsrep_node_address="{{ ansible_host }}"
wsrep_sst_auth=root:
{% elif inventory_hostname == 'maria1' %}
# Maria1 full config after bootstrap
wsrep_on=1
wsrep_cluster_name="{{ galera_cluster_name }}"
wsrep_cluster_address="gcomm://{{ hostvars['maria1']['ansible_host'] }},{{ hostvars['maria2']['ansible_host'] }},{{ hostvars['maria3']['ansible_host'] }}"
wsrep_node_name="{{ inventory_hostname }}"
wsrep_node_address="{{ ansible_host }}"
wsrep_sst_method=rsync
wsrep_sst_auth=root:{{ mariadb_root_password }}
{% else %}
# Maria2 / Maria3 replicas
wsrep_on=1
wsrep_cluster_name="{{ galera_cluster_name }}"
wsrep_cluster_address="gcomm://{{ hostvars['maria1']['ansible_host'] }},{{ hostvars['maria2']['ansible_host'] }},{{ hostvars['maria3']['ansible_host'] }}"
wsrep_node_name="{{ inventory_hostname }}"
wsrep_node_address="{{ ansible_host }}"
wsrep_sst_method=rsync
wsrep_sst_auth=root:{{ mariadb_root_password }}
{% endif %}

wsrep_provider=/usr/lib64/galera/libgalera_smm.so
wsrep_slave_threads=1
wsrep_certify_nonPK=1
wsrep_max_ws_rows=0
wsrep_max_ws_size=2147483647
wsrep_debug=0
wsrep_convert_LOCK_to_trx=0
wsrep_retry_autocommit=1
wsrep_auto_increment_control=1
wsrep_drupal_282555_workaround=0
wsrep_causal_reads=0
wsrep_notify_cmd=
